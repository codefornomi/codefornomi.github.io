!function(){"use strict";function t(t){var n=typeof t;return"function"===n||"object"===n&&!!t}function n(t){return"[object Array]"==toString.call(t)}function e(t){return"[object String]"===toString.call(t)}function i(t){return!isNaN(Number(t))}function r(t){return 0==t||1==t}function o(t){return null==t}function c(t){return null!=t}function u(t,n){return c(t)?t:n}function l(t,n){for(var e=0,i=t.length;i>e&&n(t[e],e)!==!1;)e++;return t}function a(t){return"attrs["+t+"]"}function s(t,n){return i(t)?"Number("+a(n)+")":r(t)?"Boolean("+a(n)+" == true)":"String("+a(n)+")"}function f(t,e,i){var r=[];return 2==arguments.length?(t?n(t)?l(e,function(n,e){r.push(t[e]+"("+a(e)+")")}):l(e,function(t,n){r.push(s(t,n))}):l(e,function(t,n){r.push(a(n))}),r="return ["+r.join(",")+"]"):(t?n(t)?l(e,function(n,e){r.push('"'+i[e]+'": '+t[e]+"("+a(e)+")")}):l(e,function(t,n){r.push('"'+i[n]+'": '+s(t,n))}):l(e,function(t,n){r.push('"'+i[n]+'": '+a(n))}),r="return {"+r.join(",")+"}"),new Function("attrs",r)}function h(t,n){var e,i=0;return l(n,function(n){var r,o=n;-1!=p.indexOf(n)&&(o="\\"+o),r=t.match(new RegExp(o,"g")),r&&r.length>i&&(i=r.length,e=n)}),e||n[0]}var p=["|","^"],d=[",",";"," ","|","^"],m=["\r\n","\r","\n"],g=function(){function i(t,i){if(i||(i={}),n(t))this.mode="encode";else{if(!e(t))throw new Error("Incompatible format!");this.mode="parse"}this.data=t,this.options={header:u(i.header,!1),cast:u(i.cast,!0)};var r=i.lineDelimiter||i.line,o=i.cellDelimiter||i.delimiter;this.isParser()?(this.options.lineDelimiter=r||h(this.data,m),this.options.cellDelimiter=o||h(this.data,d),this.data=c(this.data,this.options.lineDelimiter)):this.isEncoder()&&(this.options.lineDelimiter=r||"\r\n",this.options.cellDelimiter=o||",")}function r(t,n,e){t(new n(e))}function c(t,n){return t.slice(-n.length)!=n&&(t+=n),t}function a(i){return n(i)?"array":t(i)?"object":e(i)?"string":o(i)?"null":"primitive"}return i.prototype.set=function(t,n){return this.options[t]=n},i.prototype.isParser=function(){return"parse"==this.mode},i.prototype.isEncoder=function(){return"encode"==this.mode},i.prototype.parse=function(t){function e(){a={escaped:!1,quote:!1,cell:!0}}function i(){g.cell=""}function o(){g.line=[]}function c(t){g.line.push(a.escaped?t.slice(1,-1).replace(/""/g,'"'):t),i(),e()}function u(t){c(t.slice(0,1-d.lineDelimiter.length))}function l(){m?n(m)?(s=f(d.cast,g.line,m),(l=function(){r(t,s,g.line)})()):m=g.line:(s||(s=f(d.cast,g.line)),(l=function(){r(t,s,g.line)})())}if("parse"==this.mode){if(0===this.data.trim().length)return[];var a,s,h,p=this.data,d=this.options,m=d.header,g={cell:"",line:[]};t||(h=[],t=function(t){h.push(t)}),e(),1==d.lineDelimiter.length&&(u=c);var y,v,j,w=p.length,D=d.cellDelimiter.charCodeAt(0),b=d.lineDelimiter.charCodeAt(d.lineDelimiter.length-1);for(y=0,v=0;w>y;y++)j=p.charCodeAt(y),a.cell&&(a.cell=!1,34==j)?a.escaped=!0:a.escaped&&34==j?a.quote=!a.quote:(a.escaped&&a.quote||!a.escaped)&&(j==D?(c(g.cell+p.slice(v,y)),v=y+1):j==b&&(u(g.cell+p.slice(v,y)),v=y+1,l(),o()));return h?h:this}},i.prototype.serialize={object:function(t){var n=this,e=Object.keys(t),i=Array(e.length);return l(e,function(e,r){i[r]=n[a(t[e])](t[e])}),i},array:function(t){var n=this,e=Array(t.length);return l(t,function(t,i){e[i]=n[a(t)](t)}),e},string:function(t){return'"'+String(t).replace(/"/g,'""')+'"'},"null":function(){return""},primitive:function(t){return t}},i.prototype.encode=function(t){function e(t){return t.join(c.cellDelimiter)}if("encode"==this.mode){if(0==this.data.length)return"";var i,r,o=this.data,c=this.options,u=c.header,s=o[0],f=this.serialize,h=0;t||(r=Array(o.length),t=function(t,n){r[n+h]=t}),u&&(n(u)||(i=Object.keys(s),u=i),t(e(f.array(u)),0),h=1);var p,d=a(s);return"array"==d?(n(c.cast)?(p=Array(c.cast.length),l(c.cast,function(t,n){p[n]=t.toLowerCase()})):(p=Array(s.length),l(s,function(t,n){p[n]=a(t)})),l(o,function(n,i){var r=Array(p.length);l(n,function(t,n){r[n]=f[p[n]](t)}),t(e(r),i)})):"object"==d&&(i=Object.keys(s),n(c.cast)?(p=Array(c.cast.length),l(c.cast,function(t,n){p[n]=t.toLowerCase()})):(p=Array(i.length),l(i,function(t,n){p[n]=a(s[t])})),l(o,function(n,r){var o=Array(i.length);l(i,function(t,e){o[e]=f[p[e]](n[t])}),t(e(o),r)})),r?r.join(c.lineDelimiter):this}},i.prototype.forEach=function(t){return this[this.mode](t)},i}();g.parse=function(t,n){return new g(t,n).parse()},g.encode=function(t,n){return new g(t,n).encode()},g.forEach=function(t,n,e){return 2==arguments.length&&(e=n),new g(t,n).forEach(e)},"function"==typeof define&&define.amd?define("CSV",[],function(){return g}):"object"==typeof module&&module.exports?module.exports=g:window&&(window.CSV=g)}();